# hisss
A snakemake workflow to download/align reads to targets and produce useful outputs. Hisss stands for HIgh-throughput Sequence Searching Software.

## Installing

Getting it up and running is hopefully simple:

    git clone https://github.com/louiejtaylor/hisss
    cd hisss
    
We use conda to handle dependencies; you can install miniconda from [here](https://conda.io/miniconda.html). Make a new conda enviroment, then install dependencies from `requirements.txt` like so:
    
    conda create -n hisss
    source activate hisss
    conda install -c bioconda -c conda-forge --file requirements.txt 
    
Conda is great for managing dependencies and environments without requiring any admin privileges.

## Configuration

Hisss can run on both local and remote fastqs that are either paired or unpaired. The options in `config_template.yml` should be self-explanatory--just replace the placeholders with the info on your samples. 

We include two utilites to simplify adding samples to your config file. If you're running on local samples, use `list_samples.py`. Let's say your fastqs are paired, located in `/project/fastq/`, and are named like `Sample_[sample_name]_R[pair].fastq`:

    ./scripts/list_samples.py -pattern "Sample_{sample}_R{rp}.fastq" /project/fastq/ >> my_config.yml

This will append nicely-formatted sample names to `my_config.yml`. If you're using SRA data, grabbing all the samples from a study is as simple as passing the project identifier (SRP#) to `list_SRA.py` like so:

    ./scripts/list_SRA.py SRP####### >> my_config.yml

Running on arbitrary remote data is also supported (given data URLs), but this is about to be revamped to make it much easier to specify external URLs (so stay tuned!). By default, to keep the footprint small, we don't save most of the output (including downloaded fastqs) but if you'd like to keep them just remove the `temp()` from the rule definition.

## Running

To run, simply execute the following in the hisss root dir:

    snakemake -p --configfile [path/to/my_config.yml] all
    
As an example, you can run the dummy data (which should complete very quickly):

    snakemake -p --configfile test_data/test_config.yml all
    
If you want to run the dummy data again after tinkering with the Snakefile or rules, you can clean up the test output like so:

    cd test_data
    bash clean_test.sh

When you're done, to leave the conda environment:

    source deactivate

## Current workflow 

![directed acyclic graph of workflow](assets/dag.png)

(for test_config.yml, generated by [graphviz](https://www.graphviz.org/doc/info/lang.html))
